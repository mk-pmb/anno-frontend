<div class="
  annoeditor-list
  "
  :data-collapsed="String(collapsed)"
  :data-number-of-annots="annos.length"
  >
  <div class="btn-group
    anno-list-buttonbar-top
    float-left
    hidden-print
    " role="group">

    <template v-if="$store.state.offerCreateNewAnnotationButton">
      <template v-if="checkAclAuth('create')">
        <bootstrap-button eventbus-emit="create"
          btn-class="success create-new-annotation-button"
          :caption="l10n('compose_new_annot')" />
        <template v-if="isLoggedIn">
          <!-- authorized and logged in -->
          <help-button topic="compose-anno-authorized-loggedin" />
        </template>
        <template v-else>
          <!-- authorized even as guest -->
          <help-button topic="compose-anno-authorized-guest" />
        </template>
      </template><!-- end of: authorized -->
      <template v-else><!-- not authorized -->

        <bootstrap-button ref="btnAclRequestCreate"
          v-if="$store.state.permissionsRequestFormUrl
            && ($store.state.permissionsRequestAllowGuest || isLoggedIn)"
          btn-class="outline-secondary
            create-new-annotation-button
            decoy
            acl-request-create
          "
          balloon-color="body"
          >
          {{ l10n('compose_new_annot') }}
          <div slot="balloon">
            <p>{{ l10n('not_authorized') }}</p>
            <a :href="$store.state.permissionsRequestFormUrl"
              target="_blank"
              class="btn btn-sm
                btn-default
                btn-outline-success"
            >{{ l10n('request_permission_now') }}</a>
          </div>
        </bootstrap-button>
        <template v-if="isLoggedIn">
          <!-- not authorized even though we're logged in -->
          <help-button topic="compose-anno-unauthorized-loggedin" />
        </template><!-- end of: logged in but no access -->
        <template v-else>
          <!-- help-button topic="compose-anno-unauthorized-guest" />
            No help button needed in this case b/c there is no button to
            which the help could refer.
            -->
        </template>
      </template><!-- end of: unauthorized -->
    </template><!-- offerCreateNewAnnotationButton -->

  </div><!-- .anno-list-buttonbar-top.float-left -->

  <div class="btn-group
    anno-list-buttonbar-top
    float-right
    hidden-print
    " role="group">

    <bootstrap-button ref="btnCollapseAll"
      @click="collapseAll('toggle')"
      v-if="numberOfAnnotations"
      btn-class="outline-secondary"
      :data-state="collapsed ? 'hide' : 'show'"
      :icon-fa="collapsed ? 'plus' : 'minus'"
      :caption="collapsed ? l10n('open_all') : l10n('close_all')"
      />

    <bootstrap-btnbar-dropdown ref="ddSort"
      v-if="numberOfAnnotations"
      icon-fa="sort"
      :caption="l10n('sort')"
      class="dropdown-menu-sort-options"
      >
      <component :is="bootstrapOpts.tags.dropdownMenuItem"
        v-for="sortCrit in generateSortOptionsMenuItems()"
        :key="`sort_${sortCrit.name}_${sortCrit.letterOrder}`"
        :class="[
          'criterion',
          bootstrapOpts.tags.dropdownMenuItemCls,
          bootstrapOpts.tags.dropdownMenuItemBtnCls,
          'text-nowrap',
          (sortCrit.isCurrentPrimaryCriterion
            && bootstrapOpts.tags.dropdownMenuItemChosen),
          'sort-prop-' + sortCrit.name,
          'sort-order-' + sortCrit.letterOrder,
        ].filter(Boolean)"
        @click="setPrimarySortCriterionAndSort(
          sortCrit.plusMinus + sortCrit.name)"
        :data-sort-prop="sortCrit.name"
        :data-sort-order="sortCrit.letterOrder"
        >{{ l10n('sort_prop_' + sortCrit.name, '')
          || l10n('annofield_' + sortCrit.name, '')
          || sortCrit.name }}
          <span :title="l10n(`sort_order_word_${sortCrit.letterOrder}`)"
            >{{ l10n('sort_order_symbol_' + sortCrit.letterOrder) }}</span>
      </component><!-- sortCrit -->
      <component :is="bootstrapOpts.tags.dropdownMenuItem"
        key="sort_default"
        :class="[
          'criterion',
          'reset-criteria',
          /* To hide this element via CSS:
            .annoeditor-global-css .dropdown-menu-sort-options
            .criterion.reset-criteria { display: none; } */
          bootstrapOpts.tags.dropdownMenuItemCls,
          bootstrapOpts.tags.dropdownMenuItemBtnCls,
          'text-nowrap',
        ].filter(Boolean)"
        @click="setPrimarySortCriterionAndSort(false)"
        >{{ l10n('reset_to_default') }}
      </component><!-- /sort reset -->
    </bootstrap-btnbar-dropdown><!-- ddSort -->

    <bootstrap-btnbar-dropdown ref="ddUser"
      @toggle="userSessionDropDownToggled"
      :icon-fa="'user' + (isLoggedIn ? '' : '-secret')"
      :caption="userSessionInfo.shortUserId
        || userSessionInfo.userId
        || l10n('guest_identity_short')"
      >
      <template v-if="isLoggedIn">
        <component :is="bootstrapOpts.tags.dropdownMenuItem"
          :class="[
            bootstrapOpts.tags.dropdownMenuItemCls,
            bootstrapOpts.tags.dropdownMenuItemBtnCls,
            'ddi-session-logout',
          ].filter(Boolean)"
          v-if="logoutButtonVisible"
          ><bootstrap-button ref="btnLogout"
            class="btn-session-logout"
            :caption="l10n('logout')"
            :linkUrl="logoutButtonUrl"
            @click="logoutButtonClicked"
          />
        </component><!-- dropdownMenuItem -->
        <component :is="bootstrapOpts.tags.dropdownMenuItem"
          :class="[
            bootstrapOpts.tags.dropdownMenuItemCls,
            bootstrapOpts.tags.dropdownMenuItemBtnCls,
            'ddi-session-valid-until',
          ].filter(Boolean)"
          v-for="renewUts in [userSessionInfo.renewalAvailableBefore]"
          key="renewUts"
          v-if="renewUts"
          ><template v-for="jsDate in [new Date(renewUts * 1e3)]">
            {{ l10n('session_valid_until') }}:
            <bootstrap-button ref="btnRenewSession"
              icon-fa="refresh"
              @click="tryRenewSession"
            /><br>
            <time :data-uts="renewUts" :title="String(jsDate)">
              {{ jsDate.toLocaleDateString() }}<br>
              {{ jsDate.toLocaleTimeString() }}
              </time>
          </template><!-- v-for="jsDate" -->
        </component><!-- dropdownMenuItem -->
      </template><!-- isLoggedIn -->
      <template v-else><!-- guest session -->

        <component :is="bootstrapOpts.tags.dropdownMenuItem"
          v-if="$store.state.loginFormUrl"
          :class="[
            bootstrapOpts.tags.dropdownMenuItemCls,
            bootstrapOpts.tags.dropdownMenuItemBtnCls,
            'ddi-session-login',
          ].filter(Boolean)"
          ><bootstrap-button ref="btnRenewSession"
            :caption="l10n('login')"
            :linkUrl="$store.state.loginFormUrl"
          />
          <help-button topic="session-menu-login" />
        </component><!-- dropdownMenuItem -->

        <component :is="bootstrapOpts.tags.dropdownMenuItem"
          v-if="$store.state.loginRegistrationFormUrl"
          :class="[
            bootstrapOpts.tags.dropdownMenuItemCls,
            bootstrapOpts.tags.dropdownMenuItemBtnCls,
            'ddi-session-register',
          ].filter(Boolean)"
          ><bootstrap-button ref="btnRegisterUserAccount"
            :caption="l10n('register')"
            :linkUrl="$store.state.loginRegistrationFormUrl"
          />
          <help-button topic="session-menu-registration" />
        </component><!-- dropdownMenuItem -->

      </template><!-- guest session -->

      <component :is="bootstrapOpts.tags.dropdownMenuItem"
        v-if="debugCheatsReportCache"
        :class="[
          bootstrapOpts.tags.dropdownMenuItemCls,
          bootstrapOpts.tags.dropdownMenuItemBtnCls,
          'debug-cheats-report',
        ].filter(Boolean)"
        >{{ debugCheatsReportCache }}
      </component><!-- dropdownMenuItem -->
    </bootstrap-btnbar-dropdown>

  </div><!-- .anno-list-buttonbar-top.float-right -->

  <div class="btn-group
    anno-list-buttonbar-top
    float-right
    debug-feature
    debug-btngrp-anno-list-top
    hidden-print
    " role="group">
    <bootstrap-button caption="âš™" btn-class="
      outline-secondary
      debug-button-force-compose
      " eventbus-emit="create" />
  </div><!-- .anno-list-buttonbar-top.float-right -->

  <div style="clear: both;"></div>

  <div class="panel-group annot-list">
    <slot name="annot-list-empty" v-if="!annos.length" />
    <anno-viewer v-for="annotation in annos" :key="annotation.id"
      :annotation="annotation"
      :purl-id="purlId"
      :as-reply="false"
      >
    </anno-viewer>
  </div>

</div>
